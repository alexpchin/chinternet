<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="Z4rloDEPfFKjdvqxnRdVLXrdyJv9LLK2Sl7fDJrPt0Y" />
  <title>Generating a sitemap with Jekyll</title>
  <meta name="description" content="I was looking for a solution to create a new sitemap.xml file for my jekyll blog when I push my site to Heroku. I looked at some code written by Dave Perret,...">

  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P|Lora" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/app.min.css">

  <link rel="canonical" href="http://www.chinternet.lol/coding/2014/08/12/generating-a-sitemap-with-jekyll.html">
  <link rel="alternate" type="application/rss+xml" title="Chinternet - I LEARN YOU CODE. Coding tutorials, memes, cute cats, games." href="http://www.chinternet.lol/feed.xml" />

  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">

  <script src="/js/app.min.js" charset="utf-8"></script>
</head>

  <body>
    <header class="container">
  <div class="header__doge">Much learning. So knowledge.</div>
  <div class="header__nerd">NERD<span>ALERT</span></div>
  <div class="header__absolute">How bad is absolute positioning???</div>
  <a class="header__linkedin" href="https://uk.linkedin.com/in/alexpchin" target="_blank">
    Find me on LinkedIn!
  </a>
  <a class="header__click" href="http://alexchin.co.uk" target="_blank">
    <img src="/img/star.gif" />
  </a>
  <img class="header__pikachu" src="/img/pikachu.gif" />
  <img class="header__thumb" src="/img/thumb.png" />
  <img class="header__facebook" src="/img/facebook.png" />
  <img class="header__otter" src="/img/otter.gif" />
  <img class="header__glitter-cat" src="/img/glitter-cat.gif" />
  <ul>
    <li>
      <img src="/img/alex.gif">
    </li>
    <li>
      <h1 class="blink">
        <a href="/">Chinternet</a>
        <span>I learn you code.</span>
      </h1>
    </li>
    <li><img src="/img/alex.gif"></li>
  </ul>
  <div class="header__random">
    <ul>
      <li><img src="/img/8-bit/345.png"></li>
      <li><img src="/img/8-bit/380.png"></li>
      <li><img src="/img/8-bit/381.png"></li>
      <li><img src="/img/8-bit/382.png"></li>
      <li><img src="/img/8-bit/383.png"></li>
      <li><img src="/img/8-bit/384.png"></li>
      <li><img src="/img/8-bit/385.png"></li>
      <li><img src="/img/8-bit/386.png"></li>
      <li><img src="/img/8-bit/387.png"></li>
      <li><img src="/img/8-bit/388.png"></li>
      <li><img src="/img/8-bit/389.png"></li>
      <li><img src="/img/8-bit/390.png"></li>
      <li><img src="/img/8-bit/391.png"></li>
      <li><img src="/img/8-bit/392.png"></li>
      <li><img src="/img/8-bit/393.png"></li>
      <li><img src="/img/8-bit/394.png"></li>
      <li><img src="/img/8-bit/395.png"></li>
      <li><img src="/img/8-bit/396.png"></li>
      <li><img src="/img/8-bit/397.png"></li>
      <li><img src="/img/8-bit/398.png"></li>
      <li><img src="/img/8-bit/399.png"></li>
      <li><img src="/img/8-bit/400.png"></li>
      <li><img src="/img/8-bit/401.png"></li>
      <li><img src="/img/8-bit/402.png"></li>
      <li><img src="/img/8-bit/403.png"></li>
      <li><img src="/img/8-bit/404.png"></li>
      <li><img src="/img/8-bit/405.png"></li>
      <li><img src="/img/8-bit/406.png"></li>
    </ul>
  </div>
  <nav>
    <ul>
      <li><a href="/"><i class="fa fa-home"></i></a></li>
      
        
      
        
        <li>
          <a href="/tutorials/">Tutorials</a>
        </li>
        
      
      <li class="dont-click">
        <a href="http://www.alexchin.co.uk" target="_blank">don't click!</a>
      </li>
    </ul>
  </nav>
</header>

    <main class="container">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">Generating a sitemap with Jekyll</h1>
    <p class="post-meta">Aug 12, 2014</p>
  </header>

  <article class="post-content">
    <p>I was looking for a solution to create a new sitemap.xml <a href="http://www.sitemaps.org/protocol.html#xmlTagDefinitions">file</a> for my jekyll blog when I push my site to Heroku. I looked at some code written by <a href="http://www.daveperrett.com/">Dave Perret</a>, <a href="https://github.com/recurser/jekyll-plugins">here</a>.</p>

<p>This is the plugin code I ended up going with:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre></td><td class="code"><pre><span class="nb">require</span> <span class="s1">'pathname'</span>
<span class="k">module</span> <span class="nn">Jekyll</span>

  <span class="c1"># Monkey-patch an accessor for a page's containing folder, since</span>
  <span class="c1"># we need it to generate the sitemap.</span>
  <span class="k">class</span> <span class="nc">Page</span>
    <span class="k">def</span> <span class="nf">subfolder</span>
      <span class="vi">@dir</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># Sub-class Jekyll::StaticFile to allow recovery from unimportant exception</span>
  <span class="c1"># when writing the sitemap file.</span>
  <span class="k">class</span> <span class="nc">StaticSitemapFile</span> <span class="o">&lt;</span> <span class="no">StaticFile</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
      <span class="k">super</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="k">rescue</span> <span class="no">ArgumentError</span>
      <span class="kp">true</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># Generates a sitemap.xml file containing URLs of all pages and posts.</span>
  <span class="k">class</span> <span class="nc">SitemapGenerator</span> <span class="o">&lt;</span> <span class="no">Generator</span>
    <span class="n">safe</span> <span class="kp">true</span>
    <span class="n">priority</span> <span class="ss">:low</span>

    <span class="c1"># Generates the sitemap.xml file.</span>
    <span class="c1"># +site+ is the global Site object.</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
      <span class="c1"># Create the destination folder if necessary.</span>
      <span class="n">site_folder</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">config</span><span class="p">[</span><span class="s1">'destination'</span><span class="p">]</span>
      <span class="k">unless</span> <span class="no">File</span><span class="p">.</span><span class="nf">directory?</span><span class="p">(</span><span class="n">site_folder</span><span class="p">)</span>
        <span class="nb">p</span> <span class="o">=</span> <span class="no">Pathname</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">site_folder</span><span class="p">)</span>
        <span class="nb">p</span><span class="p">.</span><span class="nf">mkdir</span>
      <span class="k">end</span>

      <span class="c1"># Write the contents of sitemap.xml.</span>
      <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">site_folder</span><span class="p">,</span> <span class="s1">'sitemap.xml'</span><span class="p">),</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">generate_header</span><span class="p">())</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">generate_content</span><span class="p">(</span><span class="n">site</span><span class="p">))</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">generate_footer</span><span class="p">())</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">close</span>
      <span class="k">end</span>

      <span class="c1"># Add a static file entry for the zip file, otherwise Site::cleanup will remove it.</span>
      <span class="n">site</span><span class="p">.</span><span class="nf">static_files</span> <span class="o">&lt;&lt;</span> <span class="no">Jekyll</span><span class="o">::</span><span class="no">StaticSitemapFile</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">site</span><span class="p">.</span><span class="nf">dest</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="s1">'sitemap.xml'</span><span class="p">)</span>
      <span class="n">log</span> <span class="s1">'Generating Sitemap.xml'</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="c1"># Returns the XML header.</span>
    <span class="k">def</span> <span class="nf">generate_header</span>
      <span class="s2">"&lt;?xml version=</span><span class="se">\"</span><span class="s2">1.0</span><span class="se">\"</span><span class="s2"> encoding=</span><span class="se">\"</span><span class="s2">UTF-8</span><span class="se">\"</span><span class="s2">?&gt;</span><span class="se">\n</span><span class="s2">&lt;urlset xmlns=</span><span class="se">\"</span><span class="s2">http://www.sitemaps.org/schemas/sitemap/0.9</span><span class="se">\"</span><span class="s2">&gt;"</span>
    <span class="k">end</span>

    <span class="c1"># Returns a string containing the the XML entries.</span>
    <span class="c1"># +site+ is the global Site object.</span>
    <span class="k">def</span> <span class="nf">generate_content</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="s1">''</span>

      <span class="c1"># First, try to find any stand-alone pages.</span>
      <span class="n">site</span><span class="p">.</span><span class="nf">pages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">page</span><span class="o">|</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="nf">subfolder</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="nf">name</span>

        <span class="c1"># Skip files that don't exist yet (e.g. paginator pages)</span>
        <span class="k">next</span> <span class="k">unless</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">mod_date</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">mtime</span><span class="p">(</span><span class="n">site</span><span class="p">.</span><span class="nf">source</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>

        <span class="c1"># Use the user-specified permalink if one is given.</span>
        <span class="k">if</span> <span class="n">page</span><span class="p">.</span><span class="nf">permalink</span>
          <span class="n">path</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="nf">permalink</span>
        <span class="k">else</span>
          <span class="c1"># Be smart about the output filename.</span>
          <span class="n">path</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="sr">/.md$/</span><span class="p">,</span> <span class="s1">'.html'</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="c1"># Ignore SASS, SCSS, and CSS files</span>
        <span class="k">next</span> <span class="k">if</span> <span class="n">path</span> <span class="o">=~</span> <span class="sr">/.(sass|scss|css)$/</span>

        <span class="c1"># Remove the trailing 'index.html' if there is one, and just output the folder name.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="o">-</span><span class="mi">11</span><span class="p">]</span> <span class="k">if</span> <span class="n">path</span> <span class="o">=~</span> <span class="sr">/\/index.html$/</span>

        <span class="n">result</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mod_date</span><span class="p">,</span> <span class="n">get_attrs</span><span class="p">(</span><span class="n">page</span><span class="p">),</span> <span class="n">site</span><span class="p">)</span> <span class="k">unless</span> <span class="n">path</span> <span class="o">=~</span> <span class="sr">/error/</span>
      <span class="k">end</span>

      <span class="c1"># Next, find all the posts.</span>
      <span class="n">posts</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">site_payload</span><span class="p">[</span><span class="s1">'site'</span><span class="p">][</span><span class="s1">'posts'</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">post</span> <span class="k">in</span> <span class="n">posts</span> <span class="k">do</span>
        <span class="n">url</span>     <span class="o">=</span> <span class="n">post</span><span class="p">.</span><span class="nf">url</span>
        <span class="n">url</span>     <span class="o">=</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="n">url</span> <span class="k">unless</span> <span class="n">url</span> <span class="o">=~</span> <span class="sr">/^\//</span>
        <span class="n">url</span>     <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="o">-</span><span class="mi">11</span><span class="p">]</span> <span class="k">if</span> <span class="n">url</span><span class="o">=~</span><span class="sr">/\/index.html$/</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">entry</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">post</span><span class="p">.</span><span class="nf">date</span><span class="p">,</span> <span class="n">get_attrs</span><span class="p">(</span><span class="n">post</span><span class="p">),</span> <span class="n">site</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">result</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
      <span class="n">attrs</span>              <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span>
      <span class="n">attrs</span><span class="p">[</span><span class="ss">:changefreq</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="nf">data</span><span class="p">[</span><span class="s1">'changefreq'</span><span class="p">]</span> <span class="k">if</span> <span class="n">page</span><span class="p">.</span><span class="nf">data</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="s1">'changefreq'</span><span class="p">)</span>
      <span class="n">attrs</span><span class="p">[</span><span class="ss">:priority</span><span class="p">]</span>   <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="nf">data</span><span class="p">[</span><span class="s1">'priority'</span><span class="p">]</span> <span class="k">if</span> <span class="n">page</span><span class="p">.</span><span class="nf">data</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="s1">'priority'</span><span class="p">)</span>
      <span class="n">attrs</span>
    <span class="k">end</span>

    <span class="c1"># Returns the XML footer.</span>
    <span class="k">def</span> <span class="nf">generate_footer</span>
      <span class="s2">"</span><span class="se">\n</span><span class="s2">&lt;/urlset&gt;"</span>
    <span class="k">end</span>

    <span class="c1"># Creates an XML entry from the given path and date.</span>
    <span class="c1">#</span>
    <span class="c1">#  +path+ is the URL path to the page.</span>
    <span class="c1">#  +date+ is the date the file was modified (in the case of regular pages), or published (for blog posts).</span>
    <span class="c1">#  +changefreq+ is the frequency with which the page is expected to change (this information is used by</span>
    <span class="c1">#    e.g. the Googlebot). This may be specified in the page's YAML front matter. If it is not set, nothing</span>
    <span class="c1">#    is output for this property.</span>
    <span class="k">def</span> <span class="nf">entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
      <span class="c1"># Remove the trailing slash from the baseurl if it is present, for consistency.</span>
      <span class="n">baseurl</span> <span class="o">=</span> <span class="n">site</span><span class="p">.</span><span class="nf">config</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]</span>
      <span class="n">baseurl</span> <span class="o">=</span> <span class="n">baseurl</span><span class="p">[</span><span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">baseurl</span><span class="o">=~</span><span class="sr">/\/$/</span>
    <span class="s2">"&lt;url&gt;&lt;loc&gt;</span><span class="si">#{</span><span class="n">baseurl</span><span class="si">}#{</span><span class="n">path</span><span class="si">}</span><span class="s2">&lt;/loc&gt;&lt;lastmod&gt;</span><span class="si">#{</span><span class="n">date</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-%d"</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/lastmod&gt;</span><span class="si">#{</span><span class="n">attrs</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="s2">"xs&lt;</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">&lt;/</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">&gt;"</span> <span class="si">}</span><span class="s2">.join("</span><span class="p">\</span><span class="n">n</span><span class="s2">") }&lt;/url&gt;"</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
      <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="si">#{</span><span class="n">message</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">"</span>
    <span class="k">end</span>

  <span class="k">end</span>

<span class="k">end</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>In your _config.yaml, file - I added these options:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="ss">sitemap:
  </span><span class="c1"># local: false</span>
  <span class="ss">file: </span><span class="s2">"/sitemap.xml"</span>
  <span class="ss">exclude:
      </span><span class="o">-</span> <span class="s2">"/atom.xml"</span>
      <span class="o">-</span> <span class="s2">"/feed.xml"</span>
      <span class="o">-</span> <span class="s2">"/feed/index.xml"</span>
  <span class="ss">include_posts:
      </span><span class="o">-</span> <span class="s2">"/index.html"</span>
  <span class="ss">change_frequency_name: </span><span class="s2">"change_frequency"</span>
  <span class="ss">priority_name: </span><span class="s2">"priority"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>


  </article>

</div>

    </main>
    <footer>
  &copy; 2015 - Alex Chin
  <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>
  <ul class="footer__social-icons">
    
      <li>
        <a href="https://www.youtube.com/channel/UC4OFW5Ljzf-5dR8EgJ1zz7g" target="_blank">
          <i class="fa fa-youtube-square fa-lg"></i>
        </a>
      </li>
    
      <li>
        <a href="https://github.com/alexpchin" target="_blank">
          <i class="fa fa-github-square fa-lg"></i>
        </a>
      </li>
    
      <li>
        <a href="https://facebook.com/chinternet" target="_blank">
          <i class="fa fa-facebook-square fa-lg"></i>
        </a>
      </li>
    
      <li>
        <a href="https://twitter.com/alexpchin" target="_blank">
          <i class="fa fa-twitter-square fa-lg"></i>
        </a>
      </li>
    
  </ul>
  Inspired by <a href="http://www.lingscars.com/" target="_blank">LingsCars</a>.
</footer>

<a class="github-ribbon" href="https://github.com/alexpchin" target="_blank">
  <img src="/img/fork-me.png" alt="Fork me on Github">
</a>

  </body>
</html>
